import{_ as k,M as f,r as u,o as n,c as r,a as h,b as l,t as c,n as g,f as v,g as y,w as P,ac as U,p as S,d as T,K as p}from"./bootstrap-5b74a21d.mjs";const L={props:{requiredFields:{type:Array,default:()=>["countryCode","regionCode"]},callToAction:{type:String,default:"Login to "}},data(){var e;return{email:null,redirect:null,consentPolicy:null,emailConsentRequest:null,regionalConsentPolicies:null,requiresCustomFieldAnswers:!1,missingRequiredFields:[],loginPhase:"loginForm",loading:!1,error:null,isAuthenticated:!1,siteUser:null,newUser:!1,consentedForTargeting:((e=f("OptanonConsent").value)==null?void 0:e.search("C0004:1"))>0}},computed:{authUrl(){return`${window.location.origin}/user/authenticate${this.newUser?"/new":"/existing"}`},redirectTo(){const{redirect:e}=this;if(e)return e;const{pathname:o,search:i,hash:a}=window.location;return`${o}${i}${a}`},consentedEnforcement(){var e;return((e=this.$ss.oneTrust)==null?void 0:e.enableOneTrustEnforcment)&&!this.consentedForTargeting}},async mounted(){navigator.cookieEnabled||(this.error=new Error("Your browser does not support cookies. Please enable cookies to use this feature."));const e=await this.$idx.getContext();if(this.consentPolicy=e==null?void 0:e.application.organization.consentPolicy,this.emailConsentRequest=e==null?void 0:e.application.organization.emailConsentRequest,this.regionalConsentPolicies=e==null?void 0:e.application.organization.regionalConsentPolicies,(this.$route.fullPath==="/user/login"||this.$route.fullPath==="/user/register")&&document.referrer){const o=new URL(document.referrer);this.redirect=o.pathname}this.siteUser=await this.$idx.getUser(),this.isAuthenticated=this.$idx.isLoggedIn(),this.updatedTargetingConsent()},methods:{async handleSubmit(){var d;this.error=null,this.loading=!0;const{email:e,redirectTo:o,authUrl:i,requiredFields:a}=this,s={email:e,redirectTo:o,authUrl:i,requiredFields:a},t=await this.$idx.processLoginForm(s);t.error?this.error=t.message:t.hasRequiredFields?(this.loginPhase="registrationForm",this.newUser=(d=t==null?void 0:t.newUser)!=null?d:!1,this.missingRequiredFields=t.requiredFields):this.loginPhase="displaySuccess",this.loading=!1},async handleRegistrationFields(e){this.error=null,this.loading=!0;const i={email:this.email,values:e},a=await this.$idx.processRegistrationForm(i);a.error?this.error=a.message:await this.handleSubmit(),this.loading=!1},updatedTargetingConsent(){var e,o;((e=this.$ss.oneTrust)==null?void 0:e.enableOneTrustEnforcment)&&((o=this.$ss.oneTrust)==null?void 0:o.scriptId)&&OneTrust.OnConsentChanged(()=>{var i;this.consentedForTargeting=((i=f("OptanonConsent").value)==null?void 0:i.search("C0004:1"))>0})}}},_=e=>(S("data-v-f882087c"),e=e(),T(),e),q={key:0},z={key:1},R=_(()=>l("h3",{class:"text-danger"},"Your access level is not sufficient to access this content.",-1)),W={key:2},E=p("Continue"),x={key:0,class:"mt-3 text-danger"},A={key:3},I={key:0,class:"mt-3 text-danger"},O={key:4},B=p(" We just sent an email to "),V=p(" with your one-time login link. To finish logging in, open the email message and click the link within. "),N=_(()=>l("p",null," Note: please check your spam/junk folders. If you do not receive this email, your firewall or ISP has likely blocked it. Please add noreply@identity-x.io to your whitelist and try registering again. ",-1)),j={key:5};function Y(e,o,i,a,s,t){const d=u("LazyWebIdxFeatureOff"),b=u("LazyWebUserEmail"),F=u("LazyWebUserConsentPolicy"),C=u("LazyWebButtonElement"),w=u("LazyWebUserRegistrationForm");return n(),r("div",{class:"ebm-user-login",style:g({fontFamily:e.$ss.primaryFontFamily})},[t.consentedEnforcement?(n(),r("div",q,[h(d)])):s.isAuthenticated?(n(),r("div",z,[R,l("p",null,"You are currently logged in as "+c(s.siteUser.email)+".",1)])):s.loginPhase=="loginForm"?(n(),r("div",W,[l("h2",{class:"call-to-action",style:g({color:e.$ss.baseStyles.primaryColor})},c(i.callToAction),5),l("form",{onSubmit:o[1]||(o[1]=U((...m)=>t.handleSubmit&&t.handleSubmit(...m),["prevent"]))},[h(b,{value:s.email,"onUpdate:value":o[0]||(o[0]=m=>s.email=m),required:""},null,8,["value"]),s.consentPolicy?(n(),v(F,{key:0,"consent-policy":s.consentPolicy},null,8,["consent-policy"])):y("",!0),h(C,{color:e.$ss.baseStyles.primaryColor,class:"continue",onOnClick:t.handleSubmit},{default:P(()=>[E]),_:1},8,["color","onOnClick"])],32),s.error?(n(),r("p",x,"An error occurred: "+c(s.error),1)):y("",!0)])):s.loginPhase=="registrationForm"?(n(),r("div",A,[h(w,{fields:s.missingRequiredFields,"consent-policy":s.consentPolicy,"regional-consent-policies":s.regionalConsentPolicies,"email-consent-request":s.emailConsentRequest,disabled:s.loading,onSubmitValue:t.handleRegistrationFields},null,8,["fields","consent-policy","regional-consent-policies","email-consent-request","disabled","onSubmitValue"]),s.error?(n(),r("p",I,"An error occurred: "+c(s.error),1)):y("",!0)])):s.loginPhase=="displaySuccess"?(n(),r("div",O,[l("h2",{class:"call-to-action",style:g({color:e.$ss.baseStyles.primaryColor})},"Almost Done!",4),l("p",null,[B,l("em",null,c(s.email),1),V]),N])):(n(),r("div",j,"Error: "+c(s.error),1))],4)}var M=k(L,[["render",Y],["__scopeId","data-v-f882087c"]]);export{M as default};
