import{u as c}from"./useUUID-9e573207.mjs";import{u as f}from"./useGAMNativeAd-ef537421.mjs";import{_ as h,r as m,o as g,f as p,g as b}from"./bootstrap-5b74a21d.mjs";const v={props:{adUnit:{type:Object},containerPixelWidth:{type:Number},path:{type:String,required:!0},useAdUnitTargetId:{type:Boolean,default:!1},renderTarget:{type:Boolean,default:!0}},emits:["iframeLoaded","slotRendered","visible"],data(){return{refresh:void 0,visibility:0}},computed:{valid(){return!!this.adUnit}},created(){this.targetId=this.useAdUnitTargetId?this.adUnit.targetId:"gam-"+c()},async mounted(){this.valid&&(await this.$nextTick(),this.defineSlot())},beforeUnmount(){this.refresh&&clearTimeout(this.refresh)},methods:{async defineSlot(){let e,s=500,o=5;for(;!e;){const t=window==null?void 0:window.googletag;if(t&&document.getElementById(this.targetId)){const{sizeMapping:r,size:i}=this.adUnit,{path:a,targetId:u}=this;t.cmd.push(function(){if(e=t.defineSlot(a,i!=null?i:[[1,1]],u),r){let n=t.sizeMapping();for(const{viewport:d,size:l}of r)n=n.addSize(d,l);e=e.defineSizeMapping(n.build())}e=e.setCollapseEmptyDiv(!0),e.addService(t.pubads()),t.display(e)}),t.cmd.push(()=>{t.pubads().addEventListener("slotVisibilityChanged",n=>{const{slot:d,inViewPercentage:l}=n;d.getSlotId().getDomId()===u&&(this.visibility=l)}),t.pubads().addEventListener("slotRenderEnded",n=>{const{slot:d}=n,l=d.getSlotId().getDomId();window.setTimeout(()=>this.$emit("slotRendered"),100),l===u&&this.adUnit.type==="content-list-native"&&window.setTimeout(()=>{f.completeNativeList()},500)})})}if(await new Promise(r=>setTimeout(r,s)),s+=500,o--==0)break}e&&this.adUnit.refreshRate&&this.setRefresh(e)},setRefresh(e){const{googletag:s}=window;this.refresh=setTimeout(()=>{this.visibility>75&&s.cmd.push(function(){s.pubads().refresh([e])}),this.setRefresh(e)},1e3*this.adUnit.refreshRate)},observe(e){if(!window.MutationObserver){this.loaded=!0,this.$emit("iframeLoaded");return}const s=r=>{for(const{addedNodes:i}of r)for(const a of i)a.tagName==="IFRAME"&&(this.loaded=!0,this.$emit("iframeLoaded"))},o=new MutationObserver(s),t={attributes:!1,childList:!0,subtree:!0};o.observe(e,t),setTimeout(()=>{o&&o.disconnect()},10*1e3)},visible(){this.$emit("visible")}}};function w(e,s,o,t,r,i){const a=m("LazyGAMSlotTarget");return i.valid&&o.renderTarget?(g(),p(a,{key:0,"target-id":e.targetId,observe:i.observe,"container-pixel-width":o.containerPixelWidth,onVisible:i.visible},null,8,["target-id","observe","container-pixel-width","onVisible"])):b("",!0)}var _=h(v,[["render",w]]);export{_ as default};
